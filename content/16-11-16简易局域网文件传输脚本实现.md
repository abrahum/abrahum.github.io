---
title: 简易局域网文件传输脚本实现
date: 2016-11-16 18:32:53
taxonomies:
    tags: [Python, Code]
---

就是一个很简单的基于flask服务器脚本。

<!-- more -->

使用脚本时的文件结构：

- 脚本文件
- 分类文件夹1
  - 文件1
  - 文件2
  - ······
- 分类文件夹2
  - 文件1
  - 文件2
  - ······
- ······

*脚本的使用环境是windous，因为校内网段是172，所以使用172检索，普通路由器可以使用192来检索。*

``` python
# -*- coding: utf-8 -*-
from flask import *
import os
import socket

app = Flask(__name__,static_url_path='')

@app.route('/')
def index():
    date = []
    date = gettarget()
    return u'<!doctype html><html><head><meta charset="UTF-8"/><title> LinksMoviesServer</title><style>a{font-size: 200%;display: block;margin-left: 10vw;</style></head><body style="background:#666;width:100%;padding-top:10vh">'+date+'</body>'

@app.route('/<dirname>')
def moviesdir(dirname):
    date = []
    date = gettarget(pwd=dirname)
    return u'<!doctype html><html><head><meta charset="UTF-8"/><title>LinksMoviesServer</title><style>a{font-size: 200%;display: block;margin-left: 10vw;</style></head><body style="background:#666;width:100%;padding-top:10vh">'+date+'</body>'

@app.route('/<dirname>/<moviesname>')
def movies(dirname,moviesname):
    return send_from_directory(dirname,moviesname)

def gettarget(pwd='',moviename=''):
    ospwd = os.getcwd()
    ospwd = ospwd + '\\' + pwd
    dirlist = os.listdir(ospwd) 
    target = ''
    if pwd == '':
        for i in dirlist:
            target = target + '<a href="/'+ i +'">'+i+'</a>'
    elif moviename=='' :
        for i in dirlist:
            target = target + '<a href="/' + pwd + '/' + i +'">'+i+'</a>'
    else:
        target = ospwd + '\\' + moviename
    return target

def getip():
    IPs = socket.gethostbyname_ex(socket.gethostname())[-1]
    localIP = ''
    for i in IPs:
        if i[0:3]=='172':
            localIP = i
    return localIP

if __name__ == '__main__':
    app.run(host=getip(),threaded=True,port=666)
```