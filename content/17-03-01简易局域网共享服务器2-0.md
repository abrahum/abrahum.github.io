---
title: 简易局域网共享服务器2.0
date: 2017-03-01 13:35:00
taxonomies:
    tags: [Python, Code]
---

之前做了一个[小脚本](/2016/11/16/简易局域网文件传输脚本实现/)来共享文件，最初的作用是在寝室床上可以愉快的访问存在下面电脑里的文件。但是在使用中还是感觉不太便利，一是需要特定的文件结构，二是需要flask（事实证明杀鸡焉用牛刀）。所以有必要对之前的脚本做一个小小的升级。我想到了之前用来测试的`http.server`模块可以很好的适用于这种需求，所以查阅了`http.server`模块的文档后，做了如下脚本。

<!-- more -->

```Python
# -*- coding: utf-8 -*-
import socket
import http.server
import socketserver
import sys

def getip(head):
    IPs = socket.gethostbyname_ex(socket.gethostname())[-1]
    localIP = ''
    for i in IPs:
        if i[0:3] == head:
            localIP = i
    return localIP

if __name__ == "__main__":
    PORT = 666
    if sys.argv[1:]:
        head = sys.argv[1]
    else:
        head = '172'
    PORT = 666
    Handler = http.server.SimpleHTTPRequestHandler
    IP = getip(head)
    if IP:
        httpd = socketserver.TCPServer((getip(head), PORT), Handler)
        print("serving at "+getip(head)+":666")
        httpd.serve_forever()
    else:
        print('Invalid domain')

```

这一次的脚本对文件的结构完全没有要求。

`getip()`沿用了之前的函数，这一次可以指定ip的关键字。整个脚本等效于：

    python -m http.server 8000 --bind <your ip>